;;;
;;;Part of: Nausicaa/Glibc
;;;Contents: Glibc definitions
;;;Date: Thu Dec  4, 2008
;;;
;;;Abstract
;;;
;;;
;;;
;;;Copyright (c) 2008, 2009 Marco Maggi <marcomaggi@gna.org>
;;;
;;;This program is free software:  you can redistribute it and/or modify
;;;it under the terms of the  GNU General Public License as published by
;;;the Free Software Foundation, either version 3 of the License, or (at
;;;your option) any later version.
;;;
;;;This program is  distributed in the hope that it  will be useful, but
;;;WITHOUT  ANY   WARRANTY;  without   even  the  implied   warranty  of
;;;MERCHANTABILITY  or FITNESS FOR  A PARTICULAR  PURPOSE.  See  the GNU
;;;General Public License for more details.
;;;
;;;You should  have received  a copy of  the GNU General  Public License
;;;along with this program.  If not, see <http://www.gnu.org/licenses/>.
;;;


;;;; setup

(library (glibc sizeof)
  (export

    ;; typedefs
    time_t sizeof-time_t peek-time_t poke-time_t!

    ;; constants
    EOF
    sizeof-struct-timezone alignof-struct-timezone strideof-struct-timezone
    sizeof-struct-tm alignof-struct-tm strideof-struct-tm
    sizeof-struct-ntptimeval alignof-struct-ntptimeval strideof-struct-ntptimeval

    ;; struct accessors
    struct-timezone-tz_minuteswest-set!	struct-timezone-tz_minuteswest-ref
    struct-timezone-tz_dsttime-set!	struct-timezone-tz_dsttime-ref

    struct-tm-tm_sec-set!		struct-tm-tm_sec-ref
    struct-tm-tm_min-set!		struct-tm-tm_min-ref
    struct-tm-tm_hour-set!		struct-tm-tm_hour-ref
    struct-tm-tm_mday-set!		struct-tm-tm_mday-ref
    struct-tm-tm_mon-set!		struct-tm-tm_mon-ref
    struct-tm-tm_year-set!		struct-tm-tm_year-ref
    struct-tm-tm_wday-set!		struct-tm-tm_wday-ref
    struct-tm-tm_yday-set!		struct-tm-tm_yday-ref
    struct-tm-tm_isdst-set!		struct-tm-tm_isdst-ref
    struct-tm-tm_gmtoff-set!		struct-tm-tm_gmtoff-ref
    struct-tm-tm_zone-set!		struct-tm-tm_zone-ref

					struct-ntptimeval-time-ref
    struct-ntptimeval-maxerror-set!	struct-ntptimeval-maxerror-ref
    struct-ntptimeval-esterror-set!	struct-ntptimeval-esterror-ref
    )
  (import (r6rs)
    (uriel foreign))



;;;; helpers

(define-syntax define-primitive-parameter
  (syntax-rules ()
    ((_ ?parameter-name ?primitive-name)
     (define ?parameter-name
       (make-parameter ?primitive-name
	 (lambda (func)
	   (unless (procedure? func)
	     (assertion-violation (quote ?parameter-name)
	       (format "expected procedure as value for ~s parameter"
		 ?parameter-name)
	       func))
	   func))))))




;;;; typedefs

(define time_t				(quote @TYPEOF_TIME_T@))
(define sizeof-time_t			@SIZEOF_TIME_T@)
(define peek-time_t			@GETTEROF_TIME_T@)
(define poke-time_t!			@SETTEROF_TIME_T@)



;;;; constants

(define EOF			@VALUEOF_EOF@)




;;;; access to structures

(define sizeof-struct-timezone		@SIZEOF_STRUCT_TIMEZONE@)
(define alignof-struct-timezone		@ALIGNOF_STRUCT_TIMEZONE@)
(define strideof-struct-timezone	@STRIDEOF_STRUCT_TIMEZONE@)

(define-c-struct-accessors
  struct-timezone-tz_minuteswest-set!
  struct-timezone-tz_minuteswest-ref
  @OFFSETOF_STRUCT_TIMEZONE_TZ_MINUTESWEST@
  @SETTEROF_STRUCT_TIMEZONE_TZ_MINUTESWEST@
  @GETTEROF_STRUCT_TIMEZONE_TZ_MINUTESWEST@)

(define-c-struct-accessors
  struct-timezone-tz_dsttime-set!
  struct-timezone-tz_dsttime-ref
  @OFFSETOF_STRUCT_TIMEZONE_TZ_DSTTIME@
  @SETTEROF_STRUCT_TIMEZONE_TZ_DSTTIME@
  @GETTEROF_STRUCT_TIMEZONE_TZ_DSTTIME@)


(define sizeof-struct-tm		@SIZEOF_STRUCT_TM@)
(define alignof-struct-tm		@ALIGNOF_STRUCT_TM@)
(define strideof-struct-tm		@STRIDEOF_STRUCT_TM@)

(define-c-struct-accessors
  struct-tm-tm_sec-set!
  struct-tm-tm_sec-ref
  @OFFSETOF_STRUCT_TM_TM_SEC@
  @SETTEROF_STRUCT_TM_TM_SEC@
  @GETTEROF_STRUCT_TM_TM_SEC@)

(define-c-struct-accessors
  struct-tm-tm_min-set!
  struct-tm-tm_min-ref
  @OFFSETOF_STRUCT_TM_TM_MIN@
  @SETTEROF_STRUCT_TM_TM_MIN@
  @GETTEROF_STRUCT_TM_TM_MIN@)

(define-c-struct-accessors
  struct-tm-tm_hour-set!
  struct-tm-tm_hour-ref
  @OFFSETOF_STRUCT_TM_TM_HOUR@
  @SETTEROF_STRUCT_TM_TM_HOUR@
  @GETTEROF_STRUCT_TM_TM_HOUR@)

(define-c-struct-accessors
  struct-tm-tm_mday-set!
  struct-tm-tm_mday-ref
  @OFFSETOF_STRUCT_TM_TM_MDAY@
  @SETTEROF_STRUCT_TM_TM_MDAY@
  @GETTEROF_STRUCT_TM_TM_MDAY@)

(define-c-struct-accessors
  struct-tm-tm_mon-set!
  struct-tm-tm_mon-ref
  @OFFSETOF_STRUCT_TM_TM_MON@
  @SETTEROF_STRUCT_TM_TM_MON@
  @GETTEROF_STRUCT_TM_TM_MON@)

(define-c-struct-accessors
  struct-tm-tm_year-set!
  struct-tm-tm_year-ref
  @OFFSETOF_STRUCT_TM_TM_YEAR@
  @SETTEROF_STRUCT_TM_TM_YEAR@
  @GETTEROF_STRUCT_TM_TM_YEAR@)

(define-c-struct-accessors
  struct-tm-tm_wday-set!
  struct-tm-tm_wday-ref
  @OFFSETOF_STRUCT_TM_TM_WDAY@
  @SETTEROF_STRUCT_TM_TM_WDAY@
  @GETTEROF_STRUCT_TM_TM_WDAY@)

(define-c-struct-accessors
  struct-tm-tm_yday-set!
  struct-tm-tm_yday-ref
  @OFFSETOF_STRUCT_TM_TM_YDAY@
  @SETTEROF_STRUCT_TM_TM_YDAY@
  @GETTEROF_STRUCT_TM_TM_YDAY@)

(define-c-struct-accessors
  struct-tm-tm_isdst-set!
  struct-tm-tm_isdst-ref
  @OFFSETOF_STRUCT_TM_TM_ISDST@
  @SETTEROF_STRUCT_TM_TM_ISDST@
  @GETTEROF_STRUCT_TM_TM_ISDST@)

(define-c-struct-accessors
  struct-tm-tm_gmtoff-set!
  struct-tm-tm_gmtoff-ref
  @OFFSETOF_STRUCT_TM_TM_GMTOFF@
  @SETTEROF_STRUCT_TM_TM_GMTOFF@
  @GETTEROF_STRUCT_TM_TM_GMTOFF@)

(define-c-struct-accessors
  struct-tm-tm_zone-set!
  struct-tm-tm_zone-ref
  @OFFSETOF_STRUCT_TM_TM_ZONE@
  @SETTEROF_STRUCT_TM_TM_ZONE@
  @GETTEROF_STRUCT_TM_TM_ZONE@)

(define sizeof-struct-ntptimeval	@SIZEOF_STRUCT_NTPTIMEVAL@)
(define alignof-struct-ntptimeval	@ALIGNOF_STRUCT_NTPTIMEVAL@)
(define strideof-struct-ntptimeval	@STRIDEOF_STRUCT_NTPTIMEVAL@)

(define-c-struct-accessors
  struct-ntptimeval-time-set!
  struct-ntptimeval-time-ref
  @OFFSETOF_STRUCT_NTPTIMEVAL_TIME@
  #f
  @GETTEROF_STRUCT_NTPTIMEVAL_TIME@)

(define-c-struct-accessors
  struct-ntptimeval-maxerror-set!
  struct-ntptimeval-maxerror-ref
  @OFFSETOF_STRUCT_NTPTIMEVAL_MAXERROR@
  @SETTEROF_STRUCT_NTPTIMEVAL_MAXERROR@
  @GETTEROF_STRUCT_NTPTIMEVAL_MAXERROR@)

(define-c-struct-accessors
  struct-ntptimeval-esterror-set!
  struct-ntptimeval-esterror-ref
  @OFFSETOF_STRUCT_NTPTIMEVAL_ESTERROR@
  @SETTEROF_STRUCT_NTPTIMEVAL_ESTERROR@
  @GETTEROF_STRUCT_NTPTIMEVAL_ESTERROR@)


;;;; done

)

;;; end of file
