## Part of: Nausicaa/Scripts
## Contents: custom rules
## Date: Fri Jan  9, 2009
##
## Abstract
##
##
##
## Copyright (c) 2009 Marco Maggi <marcomaggi@gna.org>
##
## This  program  is free  software:  you  can redistribute  it
## and/or modify it  under the terms of the  GNU General Public
## License as published by the Free Software Foundation, either
## version  3 of  the License,  or (at  your option)  any later
## version.
##
## This  program is  distributed in  the hope  that it  will be
## useful, but  WITHOUT ANY WARRANTY; without  even the implied
## warranty  of  MERCHANTABILITY or  FITNESS  FOR A  PARTICULAR
## PURPOSE.   See  the  GNU  General Public  License  for  more
## details.
##
## You should  have received a  copy of the GNU  General Public
## License   along   with    this   program.    If   not,   see
## <http://www.gnu.org/licenses/>.
##

#page
## ------------------------------------------------------------
## Scripts.
## ------------------------------------------------------------

scripts_BUILDDIR= $(builddir)/bin.d
scripts_BIN	=

ifeq ($(strip $(nausicaa_ENABLE_IKARUS)),yes)
scripts_BIN	+= ikarus-scheme-script
endif

ifeq ($(strip $(nausicaa_ENABLE_YPSILON)),yes)
scripts_BIN	+= ypsilon-scheme-script
endif

ifeq ($(strip $(nausicaa_ENABLE_LARCENY)),yes)
scripts_BIN	+= larceny-scheme-script
endif

scripts_INSTLST	= $(addprefix $(scripts_BUILDDIR)/,$(scripts_BIN))
scripts_INSTDIR	= $(bindir)

.PHONY: scripts-install scripts-uninstall

scripts-install:
ifneq ($(strip $(scripts_INSTLST)),)
	$(INSTALL_DIR) $(DESTDIR)$(scripts_INSTDIR)
	$(foreach f,$(scripts_INSTLST),\
	$(INSTALL_BIN) $(f) $(DESTDIR)$(scripts_INSTDIR);)
endif

scripts-uninstall:
ifneq ($(strip $(scripts_INSTLST)),)
	$(foreach f,$(scripts_INSTLST),\
	$(RM) $(DESTDIR)$(scripts_INSTDIR)/$(notdir $(f));)
	$(RMDIR) $(DESTDIR)$(scripts_INSTDIR)
endif

layout_DIRECTORIES	+= $(DESTDIR)$(scripts_INSTDIR)
layout_FILES		+= $(foreach f,$(scripts_INSTLST),$(DESTDIR)$(scripts_INSTDIR)/$(notdir $(f)))


install:	scripts-install
uninstall:	scripts-uninstall

#page
## ------------------------------------------------------------
## Binfmt configuration.
## ------------------------------------------------------------

binfmt_SRCDIR	= $(srcdir)/rc.d
binfmt_BUILDDIR	= $(builddir)/rc.d

binfmt_SOURCES	= $(binfmt_SRCDIR)/rc.scheme
binfmt_TARGETS	= $(binfmt_BUILDDIR)/rc.scheme
binfmt_INSTLST	= $(binfmt_TARGETS)
binfmt_INSTDIR	= $(sysconfdir)/rc.d

.PHONY: binfmt-all binfmt-clean binfmt-install binfmt-uninstall

binfmt-all: binfmt-builddir
	$(SED) \
		-e 's%BINDIR%$(bindir)%g'				\
		-e 's%OPT_ENABLE_IKARUS%$(nausicaa_ENABLE_IKARUS)%g'	\
		-e 's%OPT_ENABLE_LARCENY%$(nausicaa_ENABLE_LARCENY)%g'	\
		-e 's%OPT_ENABLE_YPSILON%$(nausicaa_ENABLE_YPSILON)%g'	\
		<$(binfmt_SRCDIR)/rc.scheme		\
		>$(binfmt_BUILDDIR)/rc.scheme

binfmt-clean:
	$(RM) $(binfmt_TARGETS)

binfmt-builddir:
	test -d $(binfmt_BUILDDIR) || $(MKDIR) $(binfmt_BUILDDIR)

binfmt-install:
ifneq ($(strip $(binfmt_INSTLST)),)
	$(INSTALL_DIR) $(DESTDIR)$(binfmt_INSTDIR)
	$(foreach f,$(binfmt_INSTLST),\
	$(INSTALL_DATA) $(f) $(DESTDIR)$(binfmt_INSTDIR);)
endif

binfmt-uninstall:
ifneq ($(strip $(binfmt_INSTLST)),)
	$(foreach f,$(binfmt_INSTLST),\
	$(RM) $(DESTDIR)$(binfmt_INSTDIR)/$(notdir $(f));)
	$(RMDIR) $(DESTDIR)$(binfmt_INSTDIR)
endif

layout_DIRECTORIES	+= $(DESTDIR)$(binfmt_INSTDIR)
layout_FILES		+= $(foreach f,$(binfmt_INSTLST),$(DESTDIR)$(binfmt_INSTDIR)/$(notdir $(f)))

## ------------------------------------------------------------

all:		binfmt-all
clean:		binfmt-clean
install:	binfmt-install
uninstall:	binfmt-uninstall


### end of file
# Local Variables:
# mode: makefile
# End:
