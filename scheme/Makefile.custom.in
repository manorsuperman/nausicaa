#
# Part of: Nausicaa/Scheme
# Contents: project specific makefile
# Date: Wed Jan 21, 2009
#
# Abstract
#
#
#
# Copyright (c) 2009 Marco Maggi <marcomaggi@gna.org>
#
# This program is  free software: you can redistribute  it and/or modify
# it under the  terms of the GNU General Public  License as published by
# the Free Software Foundation, either  version 3 of the License, or (at
# your option) any later version.
#
# This program  is distributed in the  hope that it will  be useful, but
# WITHOUT   ANY  WARRANTY;   without  even   the  implied   warranty  of
# MERCHANTABILITY  or FITNESS  FOR A  PARTICULAR PURPOSE.   See  the GNU
# General Public License for more details.
#
# You  should have received  a copy  of the  GNU General  Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.
#

#page
## ------------------------------------------------------------
## Configuration variables.
## ------------------------------------------------------------

nau_scheme_ENABLE_BINFMT	= @nau_scheme_ENABLE_BINFMT@

#page
## ------------------------------------------------------------
## Binfmt scripts.
## ------------------------------------------------------------

ifeq ($(strip $(nau_scheme_ENABLE_BINFMT)),yes)

binfmt_scripts_BUILDDIR= $(builddir)/bin.d
binfmt_scripts_BIN	=

ifeq ($(strip $(nausicaa_ENABLE_IKARUS)),yes)
binfmt_scripts_BIN	+= ikarus-scheme-script
endif

ifeq ($(strip $(nausicaa_ENABLE_YPSILON)),yes)
binfmt_scripts_BIN	+= ypsilon-scheme-script
endif

ifeq ($(strip $(nausicaa_ENABLE_LARCENY)),yes)
binfmt_scripts_BIN	+= larceny-scheme-script
endif

ifeq ($(strip $(nausicaa_ENABLE_MOSH)),yes)
binfmt_scripts_BIN	+= mosh-scheme-script
endif

binfmt_scripts_INSTLST	= $(addprefix $(binfmt_scripts_BUILDDIR)/,$(binfmt_scripts_BIN))
binfmt_scripts_INSTDIR	= $(bindir)

.PHONY: binfmt-scripts-install binfmt-scripts-uninstall

binfmt-scripts-install:
ifneq ($(strip $(binfmt_scripts_INSTLST)),)
	$(INSTALL_DIR) $(DESTDIR)$(binfmt_scripts_INSTDIR)
	$(foreach f,$(binfmt_scripts_INSTLST),\
	$(INSTALL_BIN) $(f) $(DESTDIR)$(binfmt_scripts_INSTDIR);)
endif

binfmt-scripts-uninstall:
ifneq ($(strip $(binfmt_scripts_INSTLST)),)
	$(foreach f,$(binfmt_scripts_INSTLST),\
	$(RM) $(DESTDIR)$(binfmt_scripts_INSTDIR)/$(notdir $(f));)
	$(RMDIR) $(DESTDIR)$(binfmt_scripts_INSTDIR)
endif

layout_DIRECTORIES	+= $(DESTDIR)$(binfmt_scripts_INSTDIR)
layout_FILES		+= $(foreach f,$(binfmt_scripts_INSTLST),$(DESTDIR)$(binfmt_scripts_INSTDIR)/$(notdir $(f)))

## ------------------------------------------------------------

install:	binfmt-scripts-install
uninstall:	binfmt-scripts-uninstall

endif

#page
## ------------------------------------------------------------
## Binfmt configuration.
## ------------------------------------------------------------

ifeq ($(strip $(nau_scheme_ENABLE_BINFMT)),yes)

binfmt_config_SRCDIR	= $(srcdir)/rc.d
binfmt_config_BUILDDIR	= $(builddir)/rc.d

binfmt_config_SOURCES	= $(binfmt_config_SRCDIR)/rc.scheme
binfmt_config_TARGETS	= $(binfmt_config_BUILDDIR)/rc.scheme
binfmt_config_INSTLST	= $(binfmt_config_TARGETS)
binfmt_config_INSTDIR	= $(sysconfdir)/rc.d

.PHONY: binfmt-config-all binfmt-config-clean binfmt-config-install binfmt-config-uninstall

binfmt-config-all: binfmt-config-builddir
	$(SED) \
		-e 's%BINDIR%$(bindir)%g'				\
		-e 's%OPT_ENABLE_IKARUS%$(nausicaa_ENABLE_IKARUS)%g'	\
		-e 's%OPT_ENABLE_LARCENY%$(nausicaa_ENABLE_LARCENY)%g'	\
		-e 's%OPT_ENABLE_MOSH%$(nausicaa_ENABLE_MOSH)%g'	\
		-e 's%OPT_ENABLE_YPSILON%$(nausicaa_ENABLE_YPSILON)%g'	\
		<$(binfmt_config_SRCDIR)/rc.scheme		\
		>$(binfmt_config_BUILDDIR)/rc.scheme

binfmt-config-clean:
	$(RM) $(binfmt_config_TARGETS)

binfmt-config-builddir:
	test -d $(binfmt_config_BUILDDIR) || $(MKDIR) $(binfmt_config_BUILDDIR)

binfmt-config-install:
ifneq ($(strip $(binfmt_config_INSTLST)),)
	$(INSTALL_DIR) $(DESTDIR)$(binfmt_config_INSTDIR)
	$(foreach f,$(binfmt_config_INSTLST),\
	$(INSTALL_BIN) $(f) $(DESTDIR)$(binfmt_config_INSTDIR);)
endif

binfmt-config-uninstall:
ifneq ($(strip $(binfmt_config_INSTLST)),)
	$(foreach f,$(binfmt_config_INSTLST),\
	$(RM) $(DESTDIR)$(binfmt_config_INSTDIR)/$(notdir $(f));)
	$(RMDIR) $(DESTDIR)$(binfmt_config_INSTDIR)
endif

layout_DIRECTORIES	+= $(DESTDIR)$(binfmt_config_INSTDIR)
layout_FILES		+= $(foreach f,$(binfmt_config_INSTLST),$(DESTDIR)$(binfmt_config_INSTDIR)/$(notdir $(f)))

## ------------------------------------------------------------

all:		binfmt-config-all
clean:		binfmt-config-clean
install:	binfmt-config-install
uninstall:	binfmt-config-uninstall

endif



### end of file
# Local Variables:
# mode: makefile
# End:
